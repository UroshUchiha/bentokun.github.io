<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>

<head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>AIWConsumerBasics</title>
<link href="style.css" rel="stylesheet" type="text/css">
</head>

<table border="0" width="100%" height="8" bgcolor="#eeeeee">
<tr> <td width="100%" height="1"><b><font size="2" color="#000000" face="Arial, Helvetica, sans-serif"><strong><a name=Top></a>
S60 5th Edition SDK </strong></font></b><br><i>Example Applications Guide</i></td></tr> </table>
<!-- Generated by Doxygen 1.4.5 -->
<div class="tabs">
  <ul>
    <li id="current"><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<h1>AIWConsumerBasics</h1>
<p>
<a class="el" href="index.html#Intro_sec">1. About this Example</a> <br>
<a class="el" href="index.html#Arch_sec">2. Architecture</a> <br>
<a class="el" href="index.html#Design_sec">3. Design and Implementation</a><p>
<hr>
<h2><a class="anchor" name="Intro_sec">
1. About this Example</a></h2>
This Application Interworking (AIW) example application demonstrates how to use the AIW Consumer APIs. These APIs are used for requesting the Help AIW Provider to display an application specific context sensitive help file.<p>
The instructions of using the application are simple. The user should open the Options menu, which contains "Show Help" menu item. This menu item is inserted by the AIW Help Provider. Selecting that item creates a request to the AIW Help provider to show the help content. This request goes first to the AIW Framework, which then forwards it to the relevant providers (the Help provider in this case).<p>
The example application demonstrates also the attach/detach functionality of the AIW Framework. Numeric keys '1' and '2' can be used to attach and detach so called AIW interest to the AIW Framework. When the consumer's interest is attached, the Help provider can add its menu item to the Options menu. In the other hand, when the interest is not attached, only an AIW placeholder for the Help command is shown in the menu. The attach status and the number of attached providers is also shown in the main view of the example application.<p>
The service provider, which does the actual help launching, is in normal circumstances the AIW Help Provider. As all AIW providers, it is an ECOM plugin, and should exist by default in the SDK environment. Because of the nature of the AIW Framework, there may also exist other AIW providers offering the help service. In that case, the additional services are also displayed as menu items in the Options menu. On the other hand, if there are no help providers in the environment, no AIW menu items are displayed in the menu.<h3><a class="anchor" name="Sub11">
1.1. APIs demonstrated</a></h3>
This example application demonstrates the use of the following APIs:<p>
<ul>
<li>AIW Service Handler API</li><li>AIW Criteria API</li><li>AIW Generic Parameter API</li></ul>
<p>
<hr>
<h3><a class="anchor" name="Sub12">
1.2. Prerequisites</a></h3>
This example requires a familiarity with the Application Interworking Framework.<p>
<hr>
<h2><a class="anchor" name="Arch_sec">
2. Architecture</a></h2>
AIWConsumerBasics application is a standalone executable UI application. It acts as an AIW consumer application, i.e. it uses the services offered by the AIW provider modules (ECOM plugins) via the AIW Framework.<h2><a class="anchor" name="Design_sec">
3. Design and Implementation</a></h2>
<h3><a class="anchor" name="Sub31">
3.1 Capabilities</a></h3>
This application does not require any capabilities.<p>
Note that the required capabilities are provider specific. This means that the AIW Framework does not exactly state which capabilities are required for a consumer application, but these depend on the AIW providers used. Using the Help AIW provider does not require any capabilities.<h3><a class="anchor" name="Sub32">
3.2 Defining an AIW interest in the project resource file</a></h3>
One of the first steps of making AIW consumer application is to define the AIW services that the application is interested in. In AIW terms, this is called as interest. Interest is a list of criteria items, which in turn contain fields like criteria Id, AIW service command, content type and options. The interest of the example application is defined in <code>AIWConsumerBasics.rss</code> file, in <code>R_AIWCONSUMERBASICS_MENUINTEREST</code> resource. The interest contains only items for menu services, i.e. the application is not interested in using so called base services.<p>
This application is interested in showing help content, so the corresponding AIW command is <code>KAiwCmdHelp</code>. This command is used in the criteria item. The criteria id for this menu service is <code>EAIWConsumerBasicsHelpPlaceholder</code>, and is used for mapping the criteria item to a menu item. The content type is not needed, and therefore a wildcard type ("*") can be used.<h3><a class="anchor" name="Sub33">
3.3 Defining placeholders for AIW menu in the project resource file</a></h3>
The resource structure <code>MENU_PANE</code> defines the menu of the application. It contains an ordinary (non-AIW) menu item for exiting the application, but it also contains an AIW menu placeholder, in which the AIW providers can add their menu items.<h3><a class="anchor" name="Sub34">
3.4 Creating Service Handler instance and attaching the interest to the AIW Framework</a></h3>
For using AIW services, an instance of <code>CAiwServiceHandler</code> is needed. It is dynamically allocated in <a class="el" href="class_c_a_i_w_consumer_basics_app_ui.html#9ce34ba0b947863222da3c63d0481044">CAIWConsumerBasicsAppUi::ConstructL()</a> method. The next thing to do is to attach all interests to the AIW Framework. This is done by calling Service Handler's <code>AttachMenuL()</code>. If we would like to use AIW base services, the <code>AttachL()</code> method should be called for them.<h3><a class="anchor" name="Sub35">
3.5 Initializing menus</a></h3>
For enabling the AIW providers to display their menu items in the consumer application, the Options menu must be initialised. This is done in <a class="el" href="class_c_a_i_w_consumer_basics_app_ui.html#3ae77c2aed5e1270a13c14bd5aa415fe">CAIWConsumerBasicsAppUi::DynInitMenuPaneL()</a>, which is called every time when a menu (or a submenu) is opened.<p>
An important issue to note is that if the user is opening a submenu, which includes only AIW menu items, it must be handled by the AIW Framework. Therefore, Service Handler's <code>HandleSubmenuL()</code> method is called first. Only if this method returns <code>EFalse</code>, we should continue the menu initialization. (In this application we don't have an AIW submenus, so this call is actually not needed. However, it is needed if using automatic AIW submenus with <code>AIW_CASCADE_ID</code> or <code>AIW_INTELLIGENT_CASCADE_ID</code> flags, so it is left for a reference.)<p>
After <code>HandleSubmenuL()</code> call, it is possible to add application specific initialization code. Finally, the Service Handler's <code>InitializeMenuPaneL()</code> method should be called for AIW menus. This method allows the providers to replace the application's menu placeholders with their AIW menu items.<h3><a class="anchor" name="Sub36">
3.6 Executing AIW menu services</a></h3>
In Symbian environment, <code>HandleCommandL()</code> method is called each time when the user selects a menu item from the options menu. This is also the case when an AIW menu item is selected. The AIW commands cannot be recognized by the example application, so all the unidentified commands need to be forwarded to the AIW Framework.<p>
Usually, only the <code>ExecuteMenuCmdL()</code> method needs to be called for an AIW (i.e. unidentified) command. However, in this example application, we need to set up the help parameters every time before calling the <code>ExecuteMenuCmdL()</code>. These kind of initialisations might be quite time consuming. To avoid this problem, the AIW Framework introduces a method called <code>ServiceCmdByMenuCmd()</code>. By using it, it is possible to obtain the AIW service command id by the menu command id. With that information, it is possible to make the parameter data initialisation only if the user is actually going to execute the <code>KAiwCmdHelp</code> command.<h3><a class="anchor" name="Sub37">
3.7 Setting up a generic parameter list</a></h3>
A generic parameter list containing the required help parameters is set up in method <a class="el" href="class_c_a_i_w_consumer_basics_app_ui.html#6c34121ff750d9a4c1bf7b722b8f3057">CAIWConsumerBasicsAppUi::SetupGenericParamListL()</a>.<p>
When executing the Help AIW service command, two parameters need to be passed to the Help provider. These parameters are the help context UID and the help context string. To transfer these values, we need to create two <code>TAiwGenericParam</code> objects with semantic Id <code>EGenericParamHelpItem</code>. The parameter values are packed in <code>TAiwVariant</code> objects, which are automatically given some <code>TVariantTypeId</code> value. In this case, the required values are <code>EVariantTypeTUid</code> (for context UID) and <code>EVariantTypeDesC</code> (for context string). The <code>TAiwGenericParam</code> objects are then appended to a generic parameter list, which is transferred to the Help AIW provider via Service Handler's <code>ExecuteMenuCmdL()</code>.<h3><a class="anchor" name="Sub39">
3.9 Destruction</a></h3>
When exiting the example application, the Service Handler object must be deleted in the application's destructor. <hr>

<table x-use-null-cells
		style="x-cell-content-align: top;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;"
		cellspacing=0
		width=100%>
  <col style="width: 50%;">
  <col style="width: 50%;">

  <tr style="x-cell-content-align: top;"
	valign=top>
  <td style="width: 50%;
			padding-right: 10px;
			padding-left: 10px;
			border-right-style: None;
			border-left-style: None;
			border-top-style: None;
			border-bottom-style: None;"
	width=50%>
  <p style="font-family: Arial;"><small style="font-size: smaller;">© Nokia 2009</small></td>
  <td style="width: 50%;
			padding-right: 10px;
			padding-left: 10px;
			border-top-style: None;
			border-bottom-style: None;
			border-right-style: None;"
	width=50%>
  <p style="text-align: right; margin-right: -4px;"
	align=right><span style="font-weight: bold;"><a href="#Top"
													title="Back to top"><img
 src="top.gif"
	x-maintain-ratio=TRUE
	alt="Back to top"
	style="border: none;
			width: 18px;
			height: 15px;
			float: none;
			border-style: none;
			border-style: none;"
	width=18
	height=15
	border=0></a></span></td></tr>
 </table>
</body>
</html>

